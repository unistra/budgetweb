{% load budgetweb_tags %}

{% with resume=resume_depenses|dictvalue:year %}
{% with resume_montant_group=resume.0|dictvalue:montant_group %}
{% with montants_types=montants_types_depense.split %}
<table class="resumepfi">
  <thead>
    <tr>
      <th colspan="{% resume_colspan resume.1 montants_types %}" style="text-align: center;">{{ montant_group_label }}</th>
    </tr>
    <tr>
      <th rowspan="2">Enveloppe</th>
      {% for periode in resume.1 %}
      <th colspan="{{ montants_types|length }}" style="text-align: center;">{{ periode }}</th>
      {% endfor %}
      <th colspan="{{ montants_types|length }}" style="text-align: center;">Total</th> 
    </tr>
    <tr>
      {% for type in montants_types %}
      <th>{{ type }}</th>
      {% endfor %}
      {% for type in montants_types %}
      <th>{{ type }}</th>
      {% endfor %}
    </tr>
  </thead>
  <tbody>
    {% with enveloppes='Fonctionnement Personnel Investissement' %}
    {% for enveloppe in enveloppes.split %}
    <tr>
      <td>DÃ©pense {{ enveloppe }}</td>
      {% with enveloppes_montants=resume_montant_group.0|dictvalue:enveloppe %}
      {% for periode in resume.1 %}
          {% if enveloppes_montants.0 %}
          {% with types_montants=enveloppes_montants.0|dictvalue:periode %}
              {% for type in montants_types %}
      <td>{{ types_montants|dictvalue:type|intspace }} &euro;</td>
              {% endfor %}
          {% endwith %}
          {% else %}
              {% for type in montants_types %}
      <td>0,00 &euro;</td>
              {% endfor %}
          {% endif %}
      {% endfor %}
      {% for type in montants_types %}
      <td>{% if enveloppes_montants.1 %}{{ enveloppes_montants.1|dictvalue:type|intspace }}{% else %}0,00{% endif %} &euro;</td>
      {% endfor %}
      {% endwith %}
    </tr>
    {% endfor %}
    <tr>
    <td>Total</td>
    {% for periode in resume.1 %}
        {% with total_enveloppes=resume_montant_group.1|dictvalue:periode %}
        {% for type in montants_types %}
     <td>{% firstof total_enveloppes|dictvalue:type|intspace "0,00" %} &euro;</td>
        {% endfor %}
        {% endwith %}
    {% endfor %}
    {% endwith %}
    </tr>
    <tr>
      <td class="blank_row" colspan="{% resume_colspan resume.1 montants_types %}">&nbsp;</td>
    </tr>
{% endwith %}
{% endwith %}
{% endwith %}
{% with resume=resume_recettes|dictvalue:year %}
{% with resume_montant_group=resume.0|dictvalue:montant_group %}
{% with montants_types=montants_types_recette.split %}
  <thead>
    <tr>
      <th rowspan="2">Enveloppe</th>
      {% for periode in resume.1 %}
      <th colspan="{{ montants_types|length }}" style="text-align: center;">{{ periode }}</th>
      {% endfor %}
      <th colspan="{{ montants_types|length }}" style="text-align: center;">Total</th> 
    </tr>
    <tr>
      {% for type in montants_types %}
      <th>{{ type }}</th>
      {% endfor %}
      {% for type in montants_types %}
      <th>{{ type }}</th>
      {% endfor %}
    </tr>
  </thead>
  <tbody>
    {% with enveloppes='Fonctionnement Investissement' %}
    {% for enveloppe in enveloppes.split %}
    <tr>
      <td>Recette {{ enveloppe }}</td>
      {% with enveloppes_montants=resume_montant_group.0|dictvalue:enveloppe %}
      {% for periode in resume.1 %}
          {% if enveloppes_montants.0 %}
          {% with types_montants=enveloppes_montants.0|dictvalue:periode %}
              {% for type in montants_types %}
      <td>{{ types_montants|dictvalue:type|intspace }} &euro;</td>
              {% endfor %}
          {% endwith %}
          {% else %}
              {% for type in montants_types %}
      <td>0,00 &euro;</td>
              {% endfor %}
          {% endif %}
      {% endfor %}
      {% for type in montants_types %}
      <td>{% if enveloppes_montants.1 %}{{ enveloppes_montants.1|dictvalue:type|intspace }}{% else %}0,00{% endif %} &euro;</td>
      {% endfor %}
      {% endwith %}
    </tr>
    {% endfor %}
    <tr>
    <td>Total</td>
    {% for periode in resume.1 %}
        {% with total_enveloppes=resume_montant_group.1|dictvalue:periode %}
        {% for type in montants_types %}
     <td>{% firstof total_enveloppes|dictvalue:type|intspace "0,00" %} &euro;</td>
        {% endfor %}
        {% endwith %}
    {% endfor %}
    {% endwith %}
    </tr>
     </tbody>
   </table>
{% endwith %}
{% endwith %}
{% endwith %}